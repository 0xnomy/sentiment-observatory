<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sentiment Observatory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        accent: {
                            50: '#FFF2E8', 100: '#FFE5D1', 200: '#FFC6A3', 300: '#FFA475',
                            400: '#FF7D47', 500: '#FF5A1F', 600: '#F24F18', 700: '#D94412',
                            800: '#B2350C', 900: '#7A2206'
                        }
                    },
                    boxShadow: {
                        glow: '0 10px 30px -10px rgba(255,90,31,.35)'
                    },
                    keyframes: {
                        fadeUp: { '0%': { opacity: 0, transform: 'translateY(8px)' }, '100%': { opacity: 1, transform: 'translateY(0)' } },
                        pulseSoft: { '0%,100%': { opacity: .95 }, '50%': { opacity: 1 } }
                    },
                    animation: {
                        fadeUp: 'fadeUp .5s ease-out both',
                        pulseSoft: 'pulseSoft 2s ease-in-out infinite'
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        html,
        body {
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
        }

        .glass {
            backdrop-filter: blur(10px);
            background: rgba(15, 23, 42, 0.6);
        }

        .scrollbar-thin::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #0f172a;
            border-radius: 999px;
        }
    </style>
</head>

<body
    class="min-h-screen bg-slate-950 bg-[radial-gradient(75%_45%_at_50%_-10%,rgba(255,90,31,0.25),rgba(2,6,23,0.1)_60%,transparent_70%)] text-slate-100">
    <!-- Navbar -->
    <nav class="sticky top-0 z-30 border-b border-white/10 bg-slate-950/70 backdrop-blur">
        <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="h-8 w-8 rounded bg-accent-500 shadow-glow"></div>
                <div class="text-lg font-bold tracking-tight">Sentiment Observatory</div>
                <span class="ml-3 rounded-full border border-white/10 px-2 py-0.5 text-xs text-white/60">alpha</span>
            </div>
            <div class="flex items-center gap-3">
                <a href="#" class="text-sm text-white/70 hover:text-white transition">Docs</a>
                <a href="#" class="text-sm text-white/70 hover:text-white transition">GitHub</a>
                <button id="darkToggle"
                    class="ml-2 rounded-md border border-white/10 px-3 py-1.5 text-sm hover:bg-white/5 transition">Dark</button>
            </div>
        </div>
    </nav>

    <!-- Hero / Input -->
    <header class="relative mx-auto max-w-7xl px-4 pt-12 pb-6">
        <div class="grid gap-10 lg:grid-cols-2 lg:items-center">
            <div class="space-y-6 animate-fadeUp">
                <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold leading-tight">
                    Multimodal Social Content Analysis
                </h1>
                <p class="text-white/70 max-w-prose">
                    Paste a LinkedIn, Reddit, X/Twitter, or YouTube URL. We scrape/transcribe, analyze with Groq, and
                    return a JSON + text report.
                </p>
                <div class="rounded-xl border border-white/10 bg-slate-900/40 p-3">
                    <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
                        <input id="urlInput" type="url" placeholder="https://www.linkedin.com/posts/..."
                            class="w-full rounded-lg border border-white/10 bg-slate-900/70 px-4 py-3 outline-none ring-accent-500/0 focus:ring-2 transition" />
                        <div class="flex items-center gap-3">
                            <button id="analyzeBtn"
                                class="rounded-lg bg-accent-500 px-5 py-3 font-semibold shadow-glow hover:bg-accent-400 active:scale-[.98] transition">
                                Analyze
                            </button>
                        </div>
                    </div>
                    <p class="mt-2 text-xs text-white/50">Persistent LinkedIn session is used if available. Images are
                        analyzed when scraped.</p>
                </div>
            </div>
            <div class="relative hidden lg:block">
                <div class="glass rounded-2xl border border-white/10 p-6 shadow-xl animate-fadeUp">
                    <div class="mb-4 text-sm text-white/60">Live Stats (after analysis)</div>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="rounded-lg border border-white/10 bg-slate-900/40 p-4">
                            <div class="text-xs text-white/50">Platform</div>
                            <div id="statPlatform" class="mt-1 text-xl font-bold">—</div>
                        </div>
                        <div class="rounded-lg border border-white/10 bg-slate-900/40 p-4">
                            <div class="text-xs text-white/50">Sentiment</div>
                            <div id="statSentiment" class="mt-1 text-xl font-bold">—</div>
                        </div>
                        <div class="rounded-lg border border-white/10 bg-slate-900/40 p-4">
                            <div class="text-xs text-white/50">Virality</div>
                            <div id="statVirality" class="mt-1 text-xl font-bold">—</div>
                        </div>
                    </div>
                    <div class="mt-4 rounded-lg border border-white/10 bg-slate-900/40 p-4">
                        <div class="text-xs text-white/50">Summary</div>
                        <div id="statSummary" class="mt-1 line-clamp-4 text-white/90">—</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Results -->
    <main class="mx-auto max-w-7xl px-4 pb-24">
        <div id="statusPanel" class="mb-4 hidden rounded-lg border border-white/10 bg-slate-900/40 p-4">
            <div class="text-sm text-white/70">Status</div>
            <div id="statusText" class="mt-1 text-sm"></div>
            <div id="errorText" class="mt-2 text-sm text-red-400"></div>
        </div>
        <!-- Alerts / Toast -->
        <div id="toast" class="pointer-events-none fixed right-4 top-20 z-50 hidden">
            <div class="rounded-lg border border-white/10 bg-slate-900/90 px-4 py-3 shadow-xl">
                <div id="toastText" class="text-sm"></div>
            </div>
        </div>

        <!-- Loader -->
        <div id="loader" class="mb-6 hidden items-center gap-3 text-white/70">
            <svg class="h-5 w-5 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="10" stroke-width="4" class="opacity-20" />
                <path d="M22 12a10 10 0 0 1-10 10" stroke-width="4" class="opacity-70" />
            </svg>
            <span>Analyzing…</span>
        </div>

        <!-- Tabs -->
        <div class="mb-3 flex items-center gap-2">
            <button data-tab="human"
                class="tab-btn rounded-md border border-white/10 bg-slate-900/50 px-3 py-1.5 text-sm font-medium text-white/80 hover:bg-white/5">Report</button>
            <button data-tab="json"
                class="tab-btn rounded-md border border-white/10 bg-slate-900/50 px-3 py-1.5 text-sm font-medium text-white/80 hover:bg-white/5">JSON</button>
            <button data-tab="images"
                class="tab-btn rounded-md border border-white/10 bg-slate-900/50 px-3 py-1.5 text-sm font-medium text-white/80 hover:bg-white/5">Images</button>
            <div class="ml-auto flex items-center gap-2">
                <button id="copyJson"
                    class="rounded-md border border-white/10 bg-slate-900/50 px-3 py-1.5 text-xs hover:bg-white/5">Copy
                    JSON</button>
                <button id="copyText"
                    class="rounded-md border border-white/10 bg-slate-900/50 px-3 py-1.5 text-xs hover:bg-white/5">Copy
                    Text</button>
            </div>
        </div>

        <!-- Panels -->
        <section id="panelHuman" class="tab-panel hidden animate-fadeUp">
            <div id="humanReport" class="whitespace-pre-wrap rounded-xl border border-white/10 bg-slate-900/40 p-5">
            </div>
        </section>

        <section id="panelJson" class="tab-panel hidden animate-fadeUp">
            <pre
                class="scrollbar-thin rounded-xl border border-white/10 bg-slate-900/40 p-5 text-sm"><code id="jsonReport" class="text-white/90">{}</code></pre>
        </section>

        <section id="panelImages" class="tab-panel hidden animate-fadeUp">
            <div id="imageGrid" class="grid grid-cols-2 gap-4 md:grid-cols-3 lg:grid-cols-4"></div>
        </section>
    </main>

    <footer class="border-t border-white/10 py-8 text-center text-xs text-white/50">© Sentiment Observatory</footer>

    <script>
        const el = (id) => document.getElementById(id)
        const show = (n) => n.classList.remove('hidden')
        const hide = (n) => n.classList.add('hidden')

        // Tabs
        const tabs = document.querySelectorAll('.tab-btn')
        const panels = {
            human: document.getElementById('panelHuman'),
            json: document.getElementById('panelJson'),
            images: document.getElementById('panelImages')
        }
        tabs.forEach(btn => btn.addEventListener('click', () => {
            Object.values(panels).forEach(hide)
            const target = btn.dataset.tab
            show(panels[target])
            tabs.forEach(b => b.classList.remove('ring', 'ring-accent-500/40'))
            btn.classList.add('ring', 'ring-accent-500/40')
        }))

        // Toast
        function toast(msg) {
            const t = el('toast'), tt = el('toastText')
            tt.textContent = msg
            show(t)
            setTimeout(() => hide(t), 2000)
        }

        // Dark toggle (placeholder)
        el('darkToggle').addEventListener('click', () => toast('Dark mode is already on'))

        // Copy buttons
        el('copyJson').addEventListener('click', async () => {
            try { await navigator.clipboard.writeText(el('jsonReport').textContent); toast('JSON copied') } catch { }
        })
        el('copyText').addEventListener('click', async () => {
            try { await navigator.clipboard.writeText(el('humanReport').textContent); toast('Text copied') } catch { }
        })

        // Render helpers
        function renderStats(report) {
            const plat = (report.platform || '—').toUpperCase()
            const sent = (report.analysis?.sentiment?.label || '—')
            const vira = (report.analysis?.virality_score ?? '—')
            const summ = (report.analysis?.summary || '—')
            el('statPlatform').textContent = plat
            el('statSentiment').textContent = sent
            el('statVirality').textContent = vira
            el('statSummary').textContent = summ
        }
        function renderHuman(report) {
            // Prefer server’s human string if you expose it. Otherwise compose briefly.
            const lines = []
            lines.push('Platform: ' + (report.platform || 'N/A'))
            lines.push('URL: ' + (report.url || ''))
            lines.push('')
            lines.push('Summary: ' + (report.analysis?.summary || ''))
            if (report.analysis?.sentiment?.label) {
                lines.push('Sentiment: ' + report.analysis.sentiment.label)
            }
            if (report.analysis?.virality_score !== undefined) {
                lines.push('Virality Score: ' + report.analysis.virality_score)
            }
            if (report.scraped?.counts) {
                const c = report.scraped.counts
                const agg = [c.upvotes && `Upvotes ${c.upvotes}`, c.likes && `Likes ${c.likes}`, c.comments && `Comments ${c.comments}`].filter(Boolean).join(' | ')
                if (agg) lines.push('Engagement: ' + agg)
            }
            if (report.analysis?.report) {
                lines.push('')
                lines.push('Report:')
                lines.push(String(report.analysis.report))
            }
            el('humanReport').textContent = lines.join('\n')
        }
        function renderJSON(report) {
            el('jsonReport').textContent = JSON.stringify(report, null, 2)
        }
        function renderImages(report) {
            const grid = el('imageGrid')
            grid.innerHTML = ''
            const images = report.scraped?.images || []
            images.forEach(src => {
                const card = document.createElement('div')
                card.className = 'group overflow-hidden rounded-xl border border-white/10 bg-slate-900/40'
                const img = document.createElement('img')
                img.src = src
                img.alt = 'content image'
                img.className = 'aspect-video w-full object-cover transition duration-300 group-hover:scale-[1.02]'
                card.appendChild(img)
                grid.appendChild(card)
            })
            if (images.length === 0) {
                grid.innerHTML = '<div class="text-white/50">No images scraped.</div>'
            }
        }

        // Analyze action
        el('analyzeBtn').addEventListener('click', async () => {
            const url = el('urlInput').value.trim()
            if (!url) { toast('Enter a URL'); return }

            localStorage.setItem('lastURL', url)
            el('analyzeBtn').disabled = true
            el('analyzeBtn').classList.add('opacity-60', 'cursor-not-allowed')

            hide(el('panelHuman')); hide(el('panelJson')); hide(el('panelImages'))
            show(el('loader'))
            show(el('statusPanel'))
            el('statusText').textContent = 'Submitting for analysis…'
            el('errorText').textContent = ''

            try {
                const API_BASE = (window.location.origin && window.location.origin.startsWith('http'))
                    ? window.location.origin
                    : 'http://localhost:8000'

                async function callAnalyze(endpoint) {
                    const res = await fetch(API_BASE + endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url })
                    })
                    if (!res.ok) {
                        let detail = ''
                        try { const body = await res.json(); detail = body.detail || '' } catch { }
                        throw new Error(detail || `${res.status} ${res.statusText}`)
                    }
                    return res.json()
                }

                let data
                try {
                    data = await callAnalyze('/analyze')
                } catch (e1) {
                    data = await callAnalyze('/appalyze')
                }

                const report = data.report || data

                renderStats(report)
                renderHuman(report)
                renderJSON(report)
                renderImages(report)

                el('statusText').textContent = 'Analysis complete.'
                // Show default tab
                show(panels.human)
                tabs.forEach(b => b.classList.remove('ring', 'ring-accent-500/40'))
                document.querySelector('[data-tab="human"]').classList.add('ring', 'ring-accent-500/40')

                toast('Analysis complete')
            } catch (e) {
                const msg = (e && e.message) ? e.message : String(e)
                el('statusText').textContent = 'Analysis failed.'
                el('errorText').textContent = msg
                toast('Backend error: ' + msg)
            } finally {
                hide(el('loader'))
                el('analyzeBtn').disabled = false
                el('analyzeBtn').classList.remove('opacity-60', 'cursor-not-allowed')
            }
        })

        // Prefill last URL
        const last = localStorage.getItem('lastURL')
        if (last) {
            el('urlInput').value = last
        }
    </script>
</body>

</html>